(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7343],{2676:(e,s,t)=>{"use strict";t.d(s,{E1:()=>a,gf:()=>n,q7:()=>i,wz:()=>o});let r="auth_session",a=(e,s)=>{let t={user:{_id:e._id,name:e.name,email:e.email,role:e.role||"user",phone:e.phone,isGoogleUser:e.isGoogleUser,profilePicture:e.profilePicture},token:s,expiresAt:Date.now()+2592e6};localStorage.setItem(r,JSON.stringify(t))},l=()=>{try{let e=localStorage.getItem(r);if(!e)return null;let s=JSON.parse(e);if(s.expiresAt&&Date.now()>s.expiresAt)return i(),null;return s}catch(e){return console.error("Error reading session:",e),null}},n=()=>{let e=l();return(null==e?void 0:e.token)||null},o=()=>{let e=l();return(null==e?void 0:e.user)||null},i=()=>{localStorage.removeItem(r),localStorage.removeItem("user"),localStorage.removeItem("userInfo"),localStorage.removeItem("token")}},7668:(e,s,t)=>{Promise.resolve().then(t.bind(t,88864))},13119:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,O:()=>i});var r=t(95155),a=t(12115),l=t(20063),n=t(2676);let o=(0,a.createContext)({user:null,setUser:()=>{},loading:!0,login:async()=>{},register:async()=>{},verifyEmail:async()=>{},logout:()=>{}}),i=e=>{let{children:s}=e,[t,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),u=(0,l.useRouter)();(0,a.useEffect)(()=>{let e=(0,n.wz)(),s=(0,n.gf)();e&&s?(console.log("AuthContext: Restoring session. Token present:",!!s),i({...e,token:s})):console.log("AuthContext: No session found in localStorage"),d(!1)},[]);let m=async(e,s)=>{try{let t=await fetch("".concat("http://localhost:5000/api","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),r=await t.json();if(!t.ok)throw Error(r.message||"Login failed");return(0,n.E1)(r,r.token),console.log("AuthContext: Login successful. Token:",r.token?"Yes":"No"),i(r),"worker"===r.role?u.push("/worker/dashboard"):"admin"===r.role?u.push("/admin"):u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}},h=async(e,s,t,r)=>{try{let a=await fetch("".concat("http://localhost:5000/api","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:s,phone:t,password:r})}),l=await a.json();if(!a.ok)throw Error(l.message||"Signup failed");return{success:!0,message:l.message,email:l.email}}catch(e){return{success:!1,message:e.message}}},x=async(e,s)=>{try{let t=await fetch("".concat("http://localhost:5000/api","/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:s})}),r=await t.json();if(!t.ok)throw Error(r.message||"Verification failed");return(0,n.E1)(r,r.token),console.log("AuthContext: Email verified. Token:",r.token?"Yes":"No"),i(r),u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}};return(0,r.jsx)(o.Provider,{value:{user:t,setUser:i,loading:c,login:m,register:h,verifyEmail:x,logout:()=>{(0,n.q7)(),i(null),u.push("/login")}},children:s})},c=()=>(0,a.useContext)(o)},16485:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},20063:(e,s,t)=>{"use strict";var r=t(47260);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},20508:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21873:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},35299:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},37586:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},39347:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(71847).A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},64269:(e,s,t)=>{"use strict";t.d(s,{Y:()=>n,cn:()=>l});var r=t(2821),a=t(75889);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.QP)((0,r.$)(s))}function n(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}},88864:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var r=t(95155),a=t(12115),l=t(13119),n=t(35299),o=t(21873),i=t(16485),c=t(20508),d=t(39347),u=t(37586),m=t(90758),h=t(18720);function x(){var e;let{user:s}=(0,l.A)(),[t,x]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),[f,y]=(0,a.useState)(null),[v,j]=(0,a.useState)({rating:5,comment:""});(0,a.useEffect)(()=>{b()},[s]);let b=async()=>{try{let e=await fetch("".concat("http://localhost:5000/api","/bookings/mybookings"),{headers:{Authorization:"Bearer ".concat(null==s?void 0:s.token)}}),t=await e.json();Array.isArray(t)?x(t):t.bookings&&Array.isArray(t.bookings)?x(t.bookings):x([])}catch(e){console.error("Error fetching bookings:",e)}finally{p(!1)}},N=async e=>{e.preventDefault();try{var t;let e=await fetch("".concat("http://localhost:5000/api","/reviews"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null==s?void 0:s.token)},body:JSON.stringify({bookingId:f._id,workerId:null==(t=f.assignedWorker)?void 0:t._id,rating:v.rating,comment:v.comment})});if(e.ok)h.o.success("Review submitted successfully!"),y(null),j({rating:5,comment:""}),b();else{let s=await e.json();h.o.error(s.message||"Failed to submit review")}}catch(e){console.error("Error submitting review:",e),h.o.error("Failed to submit review")}};return g?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(n.A,{className:"w-8 h-8 animate-spin text-blue-600"})}):(0,r.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"My Services"}),0===t.length?(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:["No services booked yet. ",(0,r.jsx)("a",{href:"/services",className:"text-blue-600 hover:underline",children:"Browse services"})]}):(0,r.jsx)("div",{className:"grid gap-6",children:t.map(e=>(0,r.jsxs)(m.Zp,{className:"hover:shadow-lg transition-shadow",children:[(0,r.jsx)(m.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m.ZB,{className:"capitalize text-xl",children:e.serviceType}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Booked on ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-semibold ".concat("approved"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:e.status})]})}),(0,r.jsxs)(m.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(o.A,{className:"w-4 h-4 mt-1 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm",children:"Location"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.address})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(i.A,{className:"w-4 h-4 mt-1 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm",children:"Schedule"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[new Date(e.date).toLocaleDateString()," â€¢ ",e.frequency]})]})]})]}),e.assignedWorker&&(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:(0,r.jsx)(c.A,{className:"w-6 h-6 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold",children:e.assignedWorker.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.assignedWorker.profession}),(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:e.assignedWorker.rating||"4.8"})]})]})]})}),"approved"===e.status&&(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsxs)("button",{onClick:()=>y(e),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(u.A,{size:18}),"Add Review"]})})]})]})]},e._id))}),f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold mb-4",children:["Review ",null==f||null==(e=f.assignedWorker)?void 0:e.name]}),(0,r.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Rating"}),(0,r.jsx)("div",{className:"flex gap-2",children:[1,2,3,4,5].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>j({...v,rating:e}),className:"focus:outline-none",children:(0,r.jsx)(d.A,{className:"w-8 h-8 ".concat(e<=v.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")})},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Comment"}),(0,r.jsx)("textarea",{value:v.comment,onChange:e=>j({...v,comment:e.target.value}),required:!0,rows:4,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Share your experience..."})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>y(null),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Submit Review"})]})]})]})})]})}},90758:(e,s,t)=>{"use strict";t.d(s,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>n,aR:()=>o,wL:()=>u});var r=t(95155),a=t(12115),l=t(64269);let n=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...a})});n.displayName="Card";let o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...a})});o.displayName="CardHeader";let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("h3",{ref:s,className:(0,l.cn)("font-semibold leading-none tracking-tight",t),...a})});i.displayName="CardTitle";let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...a})});d.displayName="CardContent";let u=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"}},e=>{e.O(0,[4230,4909,8441,1255,7358],()=>e(e.s=7668)),_N_E=e.O()}]);