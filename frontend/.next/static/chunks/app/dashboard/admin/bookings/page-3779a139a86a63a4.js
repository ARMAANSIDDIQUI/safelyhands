(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8522],{2676:(e,t,s)=>{"use strict";s.d(t,{E1:()=>r,gf:()=>o,q7:()=>c,wz:()=>n});let a="auth_session",r=(e,t)=>{let s={user:{_id:e._id,name:e.name,email:e.email,role:e.role||"user",phone:e.phone,isGoogleUser:e.isGoogleUser,profilePicture:e.profilePicture},token:t,expiresAt:Date.now()+2592e6};localStorage.setItem(a,JSON.stringify(s))},l=()=>{try{let e=localStorage.getItem(a);if(!e)return null;let t=JSON.parse(e);if(t.expiresAt&&Date.now()>t.expiresAt)return c(),null;return t}catch(e){return console.error("Error reading session:",e),null}},o=()=>{let e=l();return(null==e?void 0:e.token)||null},n=()=>{let e=l();return(null==e?void 0:e.user)||null},c=()=>{localStorage.removeItem(a),localStorage.removeItem("user"),localStorage.removeItem("userInfo"),localStorage.removeItem("token")}},13119:(e,t,s)=>{"use strict";s.d(t,{A:()=>i,O:()=>c});var a=s(95155),r=s(12115),l=s(20063),o=s(2676);let n=(0,r.createContext)({user:null,setUser:()=>{},loading:!0,login:async()=>{},register:async()=>{},verifyEmail:async()=>{},logout:()=>{}}),c=e=>{let{children:t}=e,[s,c]=(0,r.useState)(null),[i,u]=(0,r.useState)(!0),d=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=(0,o.wz)(),t=(0,o.gf)();e&&t?(console.log("AuthContext: Restoring session. Token present:",!!t),c({...e,token:t})):console.log("AuthContext: No session found in localStorage"),u(!1)},[]);let h=async(e,t)=>{try{let s=await fetch("".concat("http://localhost:5000/api","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await s.json();if(!s.ok)throw Error(a.message||"Login failed");return(0,o.E1)(a,a.token),console.log("AuthContext: Login successful. Token:",a.token?"Yes":"No"),c(a),"worker"===a.role?d.push("/worker/dashboard"):"admin"===a.role?d.push("/admin"):d.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}},m=async(e,t,s,a)=>{try{let r=await fetch("".concat("http://localhost:5000/api","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,phone:s,password:a})}),l=await r.json();if(!r.ok)throw Error(l.message||"Signup failed");return{success:!0,message:l.message,email:l.email}}catch(e){return{success:!1,message:e.message}}},p=async(e,t)=>{try{let s=await fetch("".concat("http://localhost:5000/api","/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:t})}),a=await s.json();if(!s.ok)throw Error(a.message||"Verification failed");return(0,o.E1)(a,a.token),console.log("AuthContext: Email verified. Token:",a.token?"Yes":"No"),c(a),d.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}};return(0,a.jsx)(n.Provider,{value:{user:s,setUser:c,loading:i,login:h,register:m,verifyEmail:p,logout:()=>{(0,o.q7)(),c(null),d.push("/login")}},children:t})},i=()=>(0,r.useContext)(n)},20063:(e,t,s)=>{"use strict";var a=s(47260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},24788:(e,t,s)=>{Promise.resolve().then(s.bind(s,38359))},38359:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(95155),r=s(12115),l=s(86651),o=s(57828),n=s(52619),c=s.n(n),i=s(13119),u=s(18720),d=s(64269);function h(){let{user:e}=(0,i.A)(),[t,s]=(0,r.useState)([]),[n,h]=(0,r.useState)(!0),[m,p]=(0,r.useState)("all"),[x,g]=(0,r.useState)("");(0,r.useEffect)(()=>{f()},[]);let f=async()=>{try{let t=await fetch("".concat("http://localhost:5000/api","/bookings"),{headers:{Authorization:"Bearer ".concat(e.token)}});t.ok&&s(await t.json())}catch(e){u.o.error("Failed to load bookings")}finally{h(!1)}},y=t.filter(e=>{var t,s,a,r,l;let o="all"===m||e.status===m,n=(null==(a=e.items)||null==(s=a[0])||null==(t=s.subCategory)?void 0:t.name)||e.serviceType||"",c=(null==(l=e.user)||null==(r=l.name)?void 0:r.toLowerCase().includes(x.toLowerCase()))||e._id.includes(x)||n.toLowerCase().includes(x.toLowerCase());return o&&c});return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800 mb-6",children:"Bookings"}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between",children:[(0,a.jsxs)("div",{className:"relative w-full md:w-64",children:[(0,a.jsx)(l.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),(0,a.jsx)("input",{type:"text",placeholder:"Search user, ID...",value:x,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:border-blue-500"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:["all","pending","approved","completed"].map(e=>(0,a.jsx)("button",{onClick:()=>p(e),className:(0,d.cn)("px-4 py-2 rounded-lg text-sm font-bold capitalize transition-all",m===e?"bg-slate-800 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100"),children:e},e))})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-slate-500 text-xs uppercase font-bold",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-4",children:"ID"}),(0,a.jsx)("th",{className:"px-6 py-4",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-4",children:"Items"}),(0,a.jsx)("th",{className:"px-6 py-4",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-4",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100",children:y.map(e=>{var t,s;return(0,a.jsxs)("tr",{className:"hover:bg-slate-50/50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 font-mono text-xs text-slate-500",children:["#",e._id.slice(-6)]}),(0,a.jsx)("td",{className:"px-6 py-4 font-bold text-slate-800",children:(null==(t=e.user)?void 0:t.name)||"Unknown"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm",children:(null==(s=e.items)?void 0:s.length)>0?(0,a.jsx)("span",{className:"flex flex-col",children:e.items.map((e,t)=>{var s;return(0,a.jsxs)("span",{className:"text-slate-700",children:["â€¢ ",(null==(s=e.subCategory)?void 0:s.name)||"Item"]},t)})}):e.serviceType}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-slate-500",children:new Date(e.date).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold ".concat((e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-700";case"approved":return"bg-blue-100 text-blue-700";case"completed":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";default:return"bg-slate-100 text-slate-700"}})(e.status)),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 text-right",children:(0,a.jsx)(c(),{href:"/dashboard/admin/bookings/".concat(e._id),className:"inline-block p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:(0,a.jsx)(o.A,{size:18})})})]},e._id)})})]})})]})]})}},57828:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},64269:(e,t,s)=>{"use strict";s.d(t,{Y:()=>o,cn:()=>l});var a=s(2821),r=s(75889);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}function o(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}},86651:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])}},e=>{e.O(0,[4230,2619,4909,8441,1255,7358],()=>e(e.s=24788)),_N_E=e.O()}]);