(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5552],{2676:(e,t,s)=>{"use strict";s.d(t,{E1:()=>r,gf:()=>n,q7:()=>c,wz:()=>o});let a="auth_session",r=(e,t)=>{let s={user:{_id:e._id,name:e.name,email:e.email,role:e.role||"user",phone:e.phone,isGoogleUser:e.isGoogleUser,profilePicture:e.profilePicture},token:t,expiresAt:Date.now()+2592e6};localStorage.setItem(a,JSON.stringify(s))},l=()=>{try{let e=localStorage.getItem(a);if(!e)return null;let t=JSON.parse(e);if(t.expiresAt&&Date.now()>t.expiresAt)return c(),null;return t}catch(e){return console.error("Error reading session:",e),null}},n=()=>{let e=l();return(null==e?void 0:e.token)||null},o=()=>{let e=l();return(null==e?void 0:e.user)||null},c=()=>{localStorage.removeItem(a),localStorage.removeItem("user"),localStorage.removeItem("userInfo"),localStorage.removeItem("token")}},13119:(e,t,s)=>{"use strict";s.d(t,{A:()=>i,O:()=>c});var a=s(95155),r=s(12115),l=s(20063),n=s(2676);let o=(0,r.createContext)({user:null,setUser:()=>{},loading:!0,login:async()=>{},register:async()=>{},verifyEmail:async()=>{},logout:()=>{}}),c=e=>{let{children:t}=e,[s,c]=(0,r.useState)(null),[i,d]=(0,r.useState)(!0),u=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=(0,n.wz)(),t=(0,n.gf)();e&&t?(console.log("AuthContext: Restoring session. Token present:",!!t),c({...e,token:t})):console.log("AuthContext: No session found in localStorage"),d(!1)},[]);let h=async(e,t)=>{try{let s=await fetch("".concat("http://localhost:5000/api","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await s.json();if(!s.ok)throw Error(a.message||"Login failed");return(0,n.E1)(a,a.token),console.log("AuthContext: Login successful. Token:",a.token?"Yes":"No"),c(a),"worker"===a.role?u.push("/worker/dashboard"):"admin"===a.role?u.push("/admin"):u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}},m=async(e,t,s,a)=>{try{let r=await fetch("".concat("http://localhost:5000/api","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,phone:s,password:a})}),l=await r.json();if(!r.ok)throw Error(l.message||"Signup failed");return{success:!0,message:l.message,email:l.email}}catch(e){return{success:!1,message:e.message}}},x=async(e,t)=>{try{let s=await fetch("".concat("http://localhost:5000/api","/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:t})}),a=await s.json();if(!s.ok)throw Error(a.message||"Verification failed");return(0,n.E1)(a,a.token),console.log("AuthContext: Email verified. Token:",a.token?"Yes":"No"),c(a),u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}};return(0,a.jsx)(o.Provider,{value:{user:s,setUser:c,loading:i,login:h,register:m,verifyEmail:x,logout:()=>{(0,n.q7)(),c(null),u.push("/login")}},children:t})},i=()=>(0,r.useContext)(o)},16485:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},20063:(e,t,s)=>{"use strict";var a=s(47260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},20508:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21873:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},25999:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(95155),r=s(12115),l=s(35626),n=s(42529),o=s(78874),c=s(16485),i=s(26983),d=s(20508),u=s(21873);s(52619);var h=s(20063),m=s(13119),x=s(18720),p=s(64269);function g(){var e,t,s,g;let{id:f}=(0,h.useParams)(),j=(0,h.useRouter)(),{user:b}=(0,m.A)(),[y,v]=(0,r.useState)(null),[N,k]=(0,r.useState)(!0);(0,r.useEffect)(()=>{f&&w()},[f]);let w=async()=>{try{let e=await fetch("".concat("http://localhost:5000/api","/bookings/").concat(f),{headers:{Authorization:"Bearer ".concat(b.token)}});e.ok&&v(await e.json())}catch(e){x.o.error("Failed to fetch booking")}finally{k(!1)}},A=async e=>{try{(await fetch("".concat("http://localhost:5000/api","/bookings/").concat(f),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(b.token)},body:JSON.stringify({status:e})})).ok&&(x.o.success("Booking ".concat(e)),w())}catch(e){x.o.error("Failed to update status")}};return N?(0,a.jsx)("div",{className:"p-10 text-center",children:"Loading..."}):y?(0,a.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,a.jsx)("button",{onClick:()=>j.back(),className:"p-2 hover:bg-slate-100 rounded-full",children:(0,a.jsx)(l.A,{size:24})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-slate-800",children:["Booking #",f.slice(-6)]}),(0,a.jsxs)("p",{className:"text-slate-400 text-sm",children:["Created on ",new Date(y.createdAt).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:"pending"===y.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>A("approved"),className:"bg-green-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-600 flex items-center gap-2",children:[(0,a.jsx)(n.A,{size:18})," Approve"]}),(0,a.jsxs)("button",{onClick:()=>A("rejected"),className:"bg-red-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-600 flex items-center gap-2",children:[(0,a.jsx)(o.A,{size:18})," Reject"]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-slate-800 mb-4",children:"Ordered Items"}),(0,a.jsx)("div",{className:"space-y-4",children:(null==(e=y.items)?void 0:e.length)>0?y.items.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"border border-slate-100 rounded-xl p-4 bg-slate-50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h3",{className:"font-bold text-slate-900",children:(null==(s=e.subCategory)?void 0:s.name)||"Unknown Item"}),(0,a.jsxs)("span",{className:"font-bold text-blue-500",children:["â‚¹",e.price]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm text-slate-600",children:e.answers&&Object.entries(e.answers).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-slate-400 capitalize",children:[t,": "]}),(0,a.jsx)("span",{className:"font-medium",children:s})]},t)})})]},t)}):(0,a.jsxs)("p",{children:["Legacy Booking: ",y.serviceType]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-slate-800 mb-4",children:"Scheduling"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-500",children:(0,a.jsx)(c.A,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-400 font-bold uppercase",children:"Start Date"}),(0,a.jsx)("p",{className:"font-medium text-slate-800",children:new Date(y.date).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-500",children:(0,a.jsx)(i.A,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-400 font-bold uppercase",children:"Time"}),(0,a.jsx)("p",{className:"font-medium text-slate-800",children:y.time||"Not specified"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-slate-800 mb-4",children:"Customer"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-400",children:(0,a.jsx)(d.A,{size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-slate-900",children:null==(t=y.user)?void 0:t.name}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:null==(s=y.user)?void 0:s.email}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:null==(g=y.user)?void 0:g.phone})]})]}),(0,a.jsx)("div",{className:"border-t pt-4",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(u.A,{size:18,className:"text-slate-400 flex-shrink-0 mt-1"}),(0,a.jsx)("p",{className:"text-sm text-slate-600 leading-relaxed",children:y.address})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-slate-800 mb-4",children:"Booking Status"}),(0,a.jsx)("div",{className:(0,p.cn)("p-4 rounded-xl text-center font-bold capitalize text-lg mb-4","approved"===y.status?"bg-green-100 text-green-700":"rejected"===y.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:y.status}),y.notes&&(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg text-sm text-slate-600 italic",children:['"',y.notes,'"']})]})]})]})]}):(0,a.jsx)("div",{className:"p-10 text-center",children:"Booking not found"})}},26983:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},35626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},42529:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},64269:(e,t,s)=>{"use strict";s.d(t,{Y:()=>n,cn:()=>l});var a=s(2821),r=s(75889);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}function n(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}},73759:(e,t,s)=>{Promise.resolve().then(s.bind(s,25999))},78874:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},e=>{e.O(0,[4230,2619,4909,8441,1255,7358],()=>e(e.s=73759)),_N_E=e.O()}]);