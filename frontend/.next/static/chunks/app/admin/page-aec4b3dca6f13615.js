(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{2676:(e,s,t)=>{"use strict";t.d(s,{E1:()=>l,gf:()=>i,q7:()=>n,wz:()=>o});let a="auth_session",l=(e,s)=>{let t={user:{_id:e._id,name:e.name,email:e.email,role:e.role||"user",phone:e.phone,isGoogleUser:e.isGoogleUser,profilePicture:e.profilePicture},token:s,expiresAt:Date.now()+2592e6};localStorage.setItem(a,JSON.stringify(t))},r=()=>{try{let e=localStorage.getItem(a);if(!e)return null;let s=JSON.parse(e);if(s.expiresAt&&Date.now()>s.expiresAt)return n(),null;return s}catch(e){return console.error("Error reading session:",e),null}},i=()=>{let e=r();return(null==e?void 0:e.token)||null},o=()=>{let e=r();return(null==e?void 0:e.user)||null},n=()=>{localStorage.removeItem(a),localStorage.removeItem("user"),localStorage.removeItem("userInfo"),localStorage.removeItem("token")}},13119:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,O:()=>n});var a=t(95155),l=t(12115),r=t(20063),i=t(2676);let o=(0,l.createContext)({user:null,setUser:()=>{},loading:!0,login:async()=>{},register:async()=>{},verifyEmail:async()=>{},logout:()=>{}}),n=e=>{let{children:s}=e,[t,n]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0),u=(0,r.useRouter)();(0,l.useEffect)(()=>{let e=(0,i.wz)(),s=(0,i.gf)();e&&s?(console.log("AuthContext: Restoring session. Token present:",!!s),n({...e,token:s})):console.log("AuthContext: No session found in localStorage"),d(!1)},[]);let h=async(e,s)=>{try{let t=await fetch("".concat("http://localhost:5000/api","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),a=await t.json();if(!t.ok)throw Error(a.message||"Login failed");return(0,i.E1)(a,a.token),console.log("AuthContext: Login successful. Token:",a.token?"Yes":"No"),n(a),"worker"===a.role?u.push("/worker/dashboard"):"admin"===a.role?u.push("/admin"):u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}},x=async(e,s,t,a)=>{try{let l=await fetch("".concat("http://localhost:5000/api","/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:s,phone:t,password:a})}),r=await l.json();if(!l.ok)throw Error(r.message||"Signup failed");return{success:!0,message:r.message,email:r.email}}catch(e){return{success:!1,message:e.message}}},m=async(e,s)=>{try{let t=await fetch("".concat("http://localhost:5000/api","/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:s})}),a=await t.json();if(!t.ok)throw Error(a.message||"Verification failed");return(0,i.E1)(a,a.token),console.log("AuthContext: Email verified. Token:",a.token?"Yes":"No"),n(a),u.push("/dashboard"),{success:!0}}catch(e){return{success:!1,message:e.message}}};return(0,a.jsx)(o.Provider,{value:{user:t,setUser:n,loading:c,login:h,register:x,verifyEmail:m,logout:()=>{(0,i.q7)(),n(null),u.push("/login")}},children:s})},c=()=>(0,l.useContext)(o)},34897:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var a=t(95155),l=t(12115),r=t(38104),i=t(91761),o=t(91169),n=t(50906),c=t(1524),d=t(87454),u=t(13119),h=t(26265),x=t(82843),m=t(68425),g=t(47734),p=t(73697),j=t(33420),f=t(18037),y=t(12723),b=t(39492),v=t(69386),N=t(37665),w=t(92216),k=t(79618);let A=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"];function S(){let{user:e}=(0,u.A)(),s=(0,w.j)(),t=(0,w.G)(k.xV),S=(0,w.G)(k.FG),C="loading"===S||"idle"===S;if((0,l.useEffect)(()=>{"idle"===S&&s((0,k.VE)())},[S,s]),C&&!t)return(0,a.jsx)("div",{className:"p-8",children:"Loading analytics..."});if(!t)return(0,a.jsx)("div",{className:"p-8",children:"Failed to load data."});let{stats:F,charts:O,recentActivity:T}=t;return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-display font-bold text-slate-900",children:"Dashboard Overview"}),(0,a.jsxs)("p",{className:"text-slate-500",children:["Welcome back, ",(null==e?void 0:e.name)||"Admin",". Here's what's happening today."]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(E,{title:"Total Bookings",value:F.totalBookings,icon:(0,a.jsx)(r.A,{className:"text-blue-600",size:24}),color:"bg-blue-50"}),(0,a.jsx)(E,{title:"Total Revenue",value:"â‚¹".concat(F.totalRevenue.toLocaleString()),icon:(0,a.jsx)(i.A,{className:"text-purple-600",size:24}),color:"bg-purple-50"}),(0,a.jsx)(E,{title:"Active Workers",value:F.totalWorkers,icon:(0,a.jsx)(o.A,{className:"text-green-600",size:24}),color:"bg-green-50"}),(0,a.jsx)(E,{title:"Total Users",value:F.totalUsers,icon:(0,a.jsx)(n.A,{className:"text-blue-600",size:24}),color:"bg-blue-50"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-200",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-900 mb-6 flex items-center gap-2",children:[(0,a.jsx)(c.A,{size:18})," Revenue Overview"]}),(0,a.jsx)("div",{className:"h-[300px] w-full",children:(0,a.jsx)(h.u,{width:"100%",height:"100%",children:(0,a.jsxs)(x.b,{data:O.monthlyRevenue,children:[(0,a.jsx)(m.d,{strokeDasharray:"3 3",vertical:!1}),(0,a.jsx)(g.W,{dataKey:"name",axisLine:!1,tickLine:!1}),(0,a.jsx)(p.h,{axisLine:!1,tickLine:!1}),(0,a.jsx)(j.m,{}),(0,a.jsx)(f.N1,{type:"monotone",dataKey:"total",stroke:"#8b5cf6",strokeWidth:3,dot:{r:4}})]})})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-200",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-900 mb-6 flex items-center gap-2",children:[(0,a.jsx)(d.A,{size:18})," Service Distribution"]}),(0,a.jsx)("div",{className:"h-[300px] w-full flex justify-center",children:(0,a.jsx)(h.u,{width:"100%",height:"100%",children:(0,a.jsxs)(y.r,{children:[(0,a.jsx)(b.Fq,{data:O.bookingsByService,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"count",nameKey:"_id",children:O.bookingsByService.map((e,s)=>(0,a.jsx)(v.f,{fill:A[s%A.length]},"cell-".concat(s)))}),(0,a.jsx)(j.m,{}),(0,a.jsx)(N.s,{})]})})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[(0,a.jsx)("h3",{className:"font-bold text-slate-900 mb-4",children:"Recent Activity"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-slate-500 uppercase",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 rounded-l-lg",children:"User"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Service"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-3 rounded-r-lg",children:"Status"})]})}),(0,a.jsx)("tbody",{children:T.map(e=>{var s;return(0,a.jsxs)("tr",{className:"border-b last:border-0 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-medium",children:(null==(s=e.user)?void 0:s.name)||"Unknown"}),(0,a.jsx)("td",{className:"px-4 py-3 capitalize",children:e.serviceType}),(0,a.jsx)("td",{className:"px-4 py-3",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("completed"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:e.status})})]},e._id)})})]})})]})]})}function E(e){let{title:s,value:t,icon:l,trend:r,color:i}=e;return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,a.jsx)("div",{className:"p-3 rounded-xl ".concat(i),children:l})}),(0,a.jsx)("h3",{className:"text-3xl font-bold text-slate-900 mb-1",children:t}),(0,a.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-3",children:s}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs font-medium text-green-600",children:[(0,a.jsx)(c.A,{size:14}),r]})]})}},79618:(e,s,t)=>{"use strict";t.d(s,{Ay:()=>d,FG:()=>c,VE:()=>r,xV:()=>n});var a=t(26286),l=t(2676);let r=(0,a.zD)("analytics/fetchAnalytics",async(e,s)=>{let{getState:t,rejectWithValue:a}=s;try{let{data:e,lastFetch:s}=t().analytics,a=Date.now();if(e&&s&&a-s<3e5)return e;let r=(0,l.gf)(),i=await fetch("".concat("http://localhost:5000/api","/analytics"),{headers:{Authorization:"Bearer ".concat(r)}});if(!i.ok)throw Error("Failed to fetch analytics");return await i.json()}catch(e){return a(e.message)}}),i=(0,a.Z0)({name:"analytics",initialState:{data:null,status:"idle",error:null,lastFetch:null},reducers:{invalidateAnalytics:e=>{e.status="idle",e.lastFetch=null}},extraReducers:e=>{e.addCase(r.pending,e=>{e.status="loading"}).addCase(r.fulfilled,(e,s)=>{e.status="succeeded",e.data=s.payload,e.lastFetch=Date.now()}).addCase(r.rejected,(e,s)=>{e.status="failed",e.error=s.payload})}}),{invalidateAnalytics:o}=i.actions,n=e=>e.analytics.data,c=e=>e.analytics.status,d=i.reducer},82252:(e,s,t)=>{Promise.resolve().then(t.bind(t,34897))},92216:(e,s,t)=>{"use strict";t.d(s,{G:()=>r,j:()=>l});var a=t(1213);let l=()=>(0,a.wA)(),r=a.d4}},e=>{e.O(0,[6206,4965,8441,1255,7358],()=>e(e.s=82252)),_N_E=e.O()}]);